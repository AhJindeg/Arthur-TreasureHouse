# `微信小程序  Unit01`

### `HTTP`协议的无状态特性与状态管理

由于`HTTP`请求属于短连接请求, 请求一旦连接, 业务处理完毕后, 返回响应, 连接就会断开. 所以每次请求从业务角度来讲都是独立的请求. 我们称`HTTP`协议是无状态的.  即服务端无法将同一个客户端的多次请求涉及到的数据保存下来. 

**如何完成`HTTP`协议的状态管理呢? 有3种常见的解决方案:**

1. `cookie`

   1. 客户端发送第一次请求, 服务端接收请求, 处理请求.
   2. 服务端在响应数据包中携带`cookie`信息一起返回给客户端.
   3. 客户端接收响应, 解析得到`cookie`, 保存在客户端本地.
   4. 客户端发送后续请求时, 在请求数据包中携带`cookie`信息一起发送, 这样服务端就可以解析到以前存过的数据, 完成`http`状态管理.

2. `token`

   1. 客户端发送第一个请求, 服务端接收请求, 处理请求.
   2. 当服务端需要把一些敏感数据(用户信息等)传给客户端时(需要让客户端下次访问服务的时候带回来), 这些敏感数据不可以明文传输(容易被篡改). 所以服务端可以使用`JWT(JSON Web Token)`的方式来对这些数据进行加密(生成`token`字符串), 最后传输给客户端即可.
   3. 客户端接收到加密的`token`字符串后, 存起来(`localStorage`中)
   4. 当下次发送请求时, 从`localStorage`中获取`token`字符串, 将该字符串传给服务端. 服务端接收`token`, 通过相同的秘钥将数据解析出来, 完成`HTTP`状态管理

3. `session`

   由于`cookie`不安全, 所以可以使用session机制将敏感数据在服务端存储.流程如下:

   1. 客户端发送第一次请求, 服务端接收请求, 处理请求.

   2. 服务端将会为这个客户端分配一个`sid`与一个`session`对象(存储数据用).

      ```
      sid                 session
      abcd1234            {name:zs, age:18}
      abbb2222	        {name:ls, age:13}
      ....                .....
      ```

      服务端将会在返回响应数据时, 将`sid`以`cookie`的形式带给客户端.

   3. 客户端接收到响应数据后, 将会自动存储`cookie`. `sid`就会被存在客户端.下次发送请求时, 浏览器将会自动把`sid`带着一起发请求.

   4. 服务端接收到请求中的`sid`后, 寻找`sid`所对应的`session`对象, 从而获取上次请求存储的数据, 完成`http`的状态管理.


## 微信小程序

### 微信公众平台

微信公众平台由腾讯提供, 基于腾讯的微信服务器, 为官大的企业/ 组织/ 个人提供用户管理或咨询的平台.

服务号: 为企业/组织提供的进行用户管理和服务的平台. 例如中国移动服务号.

订阅号: 为企业/组织/个人提供的进行资讯分享的平台. 例如`csdn`订阅号.

小程序: 为企业/组织/个人提供的可以达到与原生`app`相同功能的应用. 优点是用完即走.

### 小程序的接入流程

进入微信公众平台, 注册小程序开发者账号.

`http://mp.weixin.qq.com`



### 小程序项目的文件结构

小程序项目中包含的文件类型有:

1. `.json`文件    配置文件

   `app.json`  项目根目录下,  定义全局配置参数.

   `page.json`   每个页面目录中都会有对应的`json`文件, 定义单个页面的配置参数.

2. `.wxml`文件  模板文件(类似于`html`, 定义页面的结构, 但是此处不能使用任何`HTML`标签) 

3. `.wxss`文件   样式文件(类似`css`, 语法与`css`基本一致, 定义样式)

   `app.wxss`  定义全局样式

   `page.wxss`   定义单页面的样式

4. `.js`文件   脚本文件(写代码的地方)

   `app.js`  项目根目录下.    定义整个小程序应用所需要的脚本代码.

   `page.js`   每个页面目录中都会有对应的`page.js`.  定义单个页面所需要的脚本代码.



### `app.json`

`app.json`用于对小程序进行全局配置.

> `json`配置文件的语法格式要求:
>
> `json`文件中不能写注释
>
> 字符串必须在双引号之间. `json`对象的属性名也必须在双引号之间.
>
> 数组或对象最后一个成员后不能再加逗号.
>
> `JSON`中不存在`undefined`数据类型.

#### `pages`配置项

`pages`配置项用于指定当前小程序包含哪些页面(`index` / `logs`)

```json
"pages": [
    "pages/index/index",
    "pages/logs/logs",
    "pages/test/test"
],
```

新建配置项`"pages/test/test"`将会在`pages`文件夹中新增目录`test`, 然后在`test`目录中新建"四件套". 若写在数组的第一个元素, 则会被当做首页展示.

#### `window`配置项

`window`配置项用于设置小程序导航栏/标题/窗口的内容及表现样式. `object`类型.

```json
"window": {
    "backgroundTextStyle": "dark",
    "enablePullDownRefresh": true,
    "backgroundColor": "#ccc",
    "navigationBarBackgroundColor": "#f00",
    "navigationBarTitleText": "学子影院",
    "navigationBarTextStyle": "white"
},
```

详细配置请参照:

`https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window`











